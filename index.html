<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏â‡∏µ‡∏î‡∏¢‡∏≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%233b82f6' stroke-width='2'><path stroke-linecap='round' stroke-linejoin='round' d='M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 
        0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z'/></svg>">
    <style>
        /* --- Base and Main System Styles --- */
        body { 
            font-family: 'Sarabun', sans-serif;
            transition: background-color 0.5s ease;
        }
              
        .admin-only { display: none; }
        .admin-only.show { display: block; }

        /* --- New Login Page Styles --- */
        .login-body {
            background: linear-gradient(to bottom right, #1e3a8a, #312e81);
        }

        /* Frosted Card Effect */
        .frosted-card {
            background-color: rgba(255, 255, 255, 0.15);
            -webkit-backdrop-filter: blur(12px);
            backdrop-filter: blur(12px);
            border-radius: 1rem; /* rounded-2xl */
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        /* Input Field Style */
        .input-field {
            width: 100%;
            padding: 0.75rem 1rem; /* px-4 py-3 */
            border-radius: 0.5rem; /* rounded-lg */
            border: 1px solid rgba(255, 255, 255, 0.3);
            background-color: rgba(0, 0, 0, 0.2);
            color: white;
            transition: all 0.2s ease-in-out;
        }
        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        .input-field:focus {
            outline: none;
            border-color: rgba(96, 165, 250, 0.8); /* blue-400 */
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.3); /* ring */
            background-color: rgba(0, 0, 0, 0.3);
        }

        /* Login Button Style */
        .login-button {
            width: 100%;
            background-color: #3b82f6; /* bg-blue-600 */
            color: white;
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
            border-radius: 0.5rem; /* rounded-lg */
            font-weight: 500; /* font-medium */
            transition: all 0.2s ease-in-out;
            transform: scale(1);
        }
        .login-button:hover {
            background-color: #2563eb; /* bg-blue-700 */
            transform: scale(1.02);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .login-button:active {
            transform: scale(0.98);
        }

        /* --- Animation Keyframes --- */
        @keyframes fade-in-up {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse-slow {
            0%, 100% {
                transform: scale(1);
                opacity: 0.8;
            }
            50% {
                transform: scale(1.05);
                opacity: 1;
            }
        }

        .animate-fade-in-up {
            animation: fade-in-up 0.6s ease-out forwards;
            opacity: 0; /* Start hidden */
        }

        .animate-pulse-slow {
            animation: pulse-slow 4s infinite ease-in-out;
        }

        /* --- Animated Background --- */
        #background-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: -1;
            overflow: hidden;
        }

        .bubble {
            position: absolute;
            bottom: -150px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: move-bubble 15s infinite ease-in-out alternate;
        }

        @keyframes move-bubble {
            from {
                transform: translateY(0) rotate(0deg);
            }
            to {
                transform: translateY(-120vh) rotate(360deg);
                opacity: 0;
            }
        }

        .bubble:nth-child(1) { width: 80px; height: 80px; left: 10%; animation-duration: 25s; }
        .bubble:nth-child(2) { width: 20px; height: 20px; left: 20%; animation-duration: 12s; animation-delay: 2s; }
        .bubble:nth-child(3) { width: 50px; height: 50px; left: 35%; animation-duration: 18s; animation-delay: 4s; }
        .bubble:nth-child(4) { width: 100px; height: 100px; left: 50%; animation-duration: 22s; animation-delay: 0s; }
        .bubble:nth-child(5) { width: 35px; height: 35px; left: 55%; animation-duration: 16s; animation-delay: 1s; }
        .bubble:nth-child(6) { width: 45px; height: 45px; left: 65%; animation-duration: 20s; animation-delay: 3s; }
        .bubble:nth-child(7) { width: 90px; height: 90px; left: 75%; animation-duration: 28s; animation-delay: 2s; }
        .bubble:nth-child(8) { width: 25px; height: 25px; left: 80%; animation-duration: 14s; animation-delay: 5s; }
        .bubble:nth-child(9) { width: 15px; height: 15px; left: 90%; animation-duration: 11s; animation-delay: 0s; }
        .bubble:nth-child(10) { width: 60px; height: 60px; left: 25%; animation-duration: 19s; animation-delay: 6s; }

        /* --- Print Styles --- */
      /* --- Print Styles --- */
/* --- Print Styles --- */
@media print {
    /* 1. ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î */
    #mainSystem, #loginPage, #background-animation {
        display: none;
    }

    /* 2. ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ print-container ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å) */
    #print-container {
        display: block !important;
    }

    /* 3. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏û‡∏¥‡∏°‡∏û‡πå */
    @page {
        size: A5 portrait;
        margin: 0;
    }
    
    /* 4. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡πÉ‡∏ö‡∏ô‡∏±‡∏î‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© A5 ‡∏û‡∏≠‡∏î‡∏µ */
    #print-card {
        width: 148mm;
        height: 210mm;
        padding: 10mm;
        box-sizing: border-box;
        border: none;
        margin: 0;
        page-break-after: always; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏∂‡πâ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≠‡∏á */
    }

    /* 5. ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏´‡πâ body ‡∏´‡∏£‡∏∑‡∏≠ html */
}
    </style>
</head>
<body class="login-body">

    <!-- Animated Background -->
    <div id="background-animation">
        <div class="bubble"></div><div class="bubble"></div><div class="bubble"></div><div class="bubble"></div><div class="bubble"></div>
        <div class="bubble"></div><div class="bubble"></div><div class="bubble"></div><div class="bubble"></div><div class="bubble"></div>
    </div>

    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center p-4">
        <div id="loginCard" class="frosted-card p-8 w-full max-w-md animate-fade-in-up">
            <div class="text-center mb-8">
                <div class="bg-white/30 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse-slow" style="animation-delay: 0.2s;">
                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                    </svg>
                </div>
                <h1 class="text-3xl font-bold text-white mb-2 animate-fade-in-up" style="animation-delay: 0.3s;">‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏â‡∏µ‡∏î‡∏¢‡∏≤</h1>
                <p class="text-blue-200 animate-fade-in-up" style="animation-delay: 0.4s;">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</p>
            </div>
            
            <form id="loginForm" class="space-y-6 animate-fade-in-up" style="animation-delay: 0.5s;">
                <div>
                    <label class="block text-sm font-medium text-blue-100 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                    <input type="text" id="username" class="input-field" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-blue-100 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                    <input type="password" id="password" class="input-field" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                </div>
                
                <button type="submit" class="login-button">
                    ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </form>
        
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="mainSystem" class="hidden">
        <header class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-4">
                        <div class="bg-blue-100 w-10 h-10 rounded-full flex items-center justify-center">
                            <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-800">‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏â‡∏µ‡∏î‡∏¢‡∏≤</h1>
                            <p class="text-sm text-gray-600" id="userRole">‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-600" id="currentDate"></span>
                        <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-200">
                            ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="py-4">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="bg-blue-200 rounded-xl p-1 flex justify-center w-fit mx-auto shadow-inner">
                    <nav class="flex items-center gap-x-1">
                        <button onclick="showTab('search')" id="searchTab" class="tab-button whitespace-nowrap py-2 px-4 text-sm font-medium rounded-lg bg-white text-blue-600 shadow-sm">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</button>
                        <button onclick="showTab('register')" id="registerTab" class="tab-button whitespace-nowrap py-2 px-4 text-sm font-medium rounded-lg text-gray-600 hover:bg-white hover:text-blue-600">üìù ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                        <button onclick="showTab('appointment')" id="appointmentTab" class="tab-button whitespace-nowrap py-2 px-4 text-sm font-medium rounded-lg text-gray-600 hover:bg-white hover:text-blue-600 admin-only">üìÖ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</button>
                        <button onclick="showTab('dashboard')" id="dashboardTab" class="tab-button whitespace-nowrap py-2 px-4 text-sm font-medium rounded-lg text-gray-600 hover:bg-white hover:text-blue-600 admin-only">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</button>
                    </nav>
                </div>
            </div>
        </div>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div id="searchContent" class="tab-content">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</h2>
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</label>
                        <div class="flex space-x-4">
                            <input type="text" id="searchId" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô 13 ‡∏´‡∏•‡∏±‡∏Å" maxlength="13">
                            <button onclick="searchPatient()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition duration-200">
                                ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                            </button>
                        </div>
                    </div>
                    <div id="patientInfo" class="hidden">
                        <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                            <h3 class="text-lg font-semibold text-green-800 mb-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm text-gray-600">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</p>
                                    <p class="font-medium" id="patientName"></p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</p>
                                    <p class="font-medium" id="patientPhone"></p>
                                </div>
                                <div class="col-span-1 md:col-span-2">
                                    <h4 class="font-semibold text-gray-800 mb-2">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</h4>
                                    <div id="appointmentTableContainer"></div>
                                </div>
                                <div class="col-span-1 md:col-span-2">
                                    <h4 class="font-semibold text-gray-800 mb-3">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô</h4>
                                    <div class="space-y-2" id="vaccineHistory"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="appointmentContent" class="tab-content hidden">
                 <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">üìÖ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô)</h2>
                    <form id="appointmentForm" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</label>
                                <div class="flex space-x-2">
                                    <input type="text" id="appointmentNationalId" class="flex-1 w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="1234567890123" maxlength="13">
                                    <button type="button" onclick="lookupPatientForAppointment()" class="bg-indigo-500 text-white px-4 rounded-lg hover:bg-indigo-600 transition-colors">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                                <input type="tel" id="appointmentPhone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="081-234-5678">
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠</label>
                                <input type="text" id="appointmentFirstName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                                <input type="text" id="appointmentLastName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
                            </div>
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏ß‡∏±‡∏ô)</label>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <div id="multiDateCalendar" class="max-w-md mx-auto bg-white rounded-lg shadow-sm border"></div>
                                <div class="mt-4 text-center">
                                    <p class="text-sm text-gray-600">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å/‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß: <span id="selectedDatesCount">0</span> ‡∏ß‡∏±‡∏ô)</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤</label>
                                <input type="text" id="appointmentVaccine" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤">
                            </div>
                             <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤</label>
                                <input type="text" id="appointmentDosage" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ï‡πá‡∏°‡πÇ‡∏î‡∏™, 0.5 ml">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏â‡∏µ‡∏î</label>
                                <input type="text" id="appointmentInjectionSite" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏Ç‡∏ô‡∏ã‡πâ‡∏≤‡∏¢">
                            </div>
                        </div>

                        <div class="flex justify-center">
                            <button type="button" onclick="addSelectedDates()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition duration-200">
                                ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                            </button>
                        </div>
                        <div id="appointmentDates" class="space-y-3"></div>
                        
                        <div class="flex space-x-4">
                            <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition duration-200">
                                ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢
                            </button>
                            <button type="button" onclick="printCurrentAppointmentCard()" class="w-full bg-gray-500 text-white py-3 rounded-lg font-medium hover:bg-gray-600 transition duration-200">
                                ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡∏ô‡∏±‡∏î
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="registerContent" class="tab-content hidden">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">üìù ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</h2>
                    <form id="registerForm" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠</label>
                                <input type="text" id="firstName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                                <input type="text" id="lastName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
                            </div>
                             <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</label>
                                <input type="text" id="nationalId" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="1234567890123" maxlength="13">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏â‡∏µ‡∏î</label>
                            <select id="hospital" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏â‡∏µ‡∏î</option>
                                <option value="‡∏£‡∏û.‡∏™‡∏ï.‡πÄ‡∏Ç‡∏≤‡∏Ç‡∏≤‡∏ß">‡∏£‡∏û.‡∏™‡∏ï.‡πÄ‡∏Ç‡∏≤‡∏Ç‡∏≤‡∏ß</option>
                                <option value="‡∏£‡∏û.‡∏™‡∏ï.‡πÄ‡∏Ç‡∏≤‡∏õ‡∏π‡∏ô">‡∏£‡∏û.‡∏™‡∏ï.‡πÄ‡∏Ç‡∏≤‡∏õ‡∏π‡∏ô</option>
                                <option value="‡∏£‡∏û.‡∏™‡∏ï.‡∏ó‡πà‡∏≤‡∏á‡∏¥‡πâ‡∏ß">‡∏£‡∏û.‡∏™‡∏ï.‡∏ó‡πà‡∏≤‡∏á‡∏¥‡πâ‡∏ß</option>
                                <option value="‡∏£‡∏û.‡∏™‡∏ï.‡∏ó‡∏∏‡πà‡∏á‡∏ï‡πà‡∏≠">‡∏£‡∏û.‡∏™‡∏ï.‡∏ó‡∏∏‡πà‡∏á‡∏ï‡πà‡∏≠</option>
                                <option value="‡∏£‡∏û.‡∏™‡∏ï.‡πÉ‡∏ô‡πÄ‡∏ï‡∏≤">‡∏£‡∏û.‡∏™‡∏ï.‡πÉ‡∏ô‡πÄ‡∏ï‡∏≤</option>
                                <option value="‡∏£‡∏û.‡∏™‡∏ï.‡∏ö‡∏≤‡∏á‡∏î‡∏µ">‡∏£‡∏û.‡∏™‡∏ï.‡∏ö‡∏≤‡∏á‡∏î‡∏µ</option>
                                <option value="‡∏£‡∏û.‡∏™‡∏ï.‡∏ö‡πâ‡∏≤‡∏ô‡∏ô‡∏≤‡∏ß‡∏á">‡∏£‡∏û.‡∏™‡∏ï.‡∏ö‡πâ‡∏≤‡∏ô‡∏ô‡∏≤‡∏ß‡∏á</option>
                                <option value="‡∏£‡∏û.‡∏™‡∏ï.‡∏ö‡πâ‡∏≤‡∏ô‡∏û‡∏£‡∏∏‡∏à‡∏π‡∏î">‡∏£‡∏û.‡∏™‡∏ï.‡∏ö‡πâ‡∏≤‡∏ô‡∏û‡∏£‡∏∏‡∏à‡∏π‡∏î</option>
                                <option value="‡∏£‡∏û.‡∏™‡∏ï.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏û‡∏ò‡∏¥‡πå‡πÇ‡∏ó‡∏ô">‡∏£‡∏û.‡∏™‡∏ï.‡∏ö‡πâ‡∏≤‡∏ô‡πÇ‡∏û‡∏ò‡∏¥‡πå‡πÇ‡∏ó‡∏ô</option>
                                <option value="‡∏£‡∏û.‡∏™‡∏ï.‡∏ö‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡∏≠‡∏á‡∏õ‡∏£‡∏∑‡∏≠">‡∏£‡∏û.‡∏™‡∏ï.‡∏ö‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡∏≠‡∏á‡∏õ‡∏£‡∏∑‡∏≠</option>
                                <option value="‡∏£‡∏û.‡∏™‡∏ï.‡∏ö‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡∏≠‡∏á‡∏´‡∏°‡∏≠">‡∏£‡∏û.‡∏™‡∏ï.‡∏ö‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡∏≠‡∏á‡∏´‡∏°‡∏≠</option>
                                <option value="‡∏£‡∏û.‡∏™‡∏ï.‡∏ö‡πâ‡∏≤‡∏ô‡∏´‡πâ‡∏ß‡∏¢‡∏ô‡πâ‡∏≥‡πÄ‡∏¢‡πá‡∏ô">‡∏£‡∏û.‡∏™‡∏ï.‡∏ö‡πâ‡∏≤‡∏ô‡∏´‡πâ‡∏ß‡∏¢‡∏ô‡πâ‡∏≥‡πÄ‡∏¢‡πá‡∏ô</option>
                                <option value="‡∏£‡∏û.‡∏™‡∏ï.‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏Ñ‡∏•‡∏≠‡∏á">‡∏£‡∏û.‡∏™‡∏ï.‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏Ñ‡∏•‡∏≠‡∏á</option>
                                <option value="‡∏£‡∏û.‡∏™‡∏ï.‡∏õ‡∏≤‡∏Å‡∏Ñ‡∏°">‡∏£‡∏û.‡∏™‡∏ï.‡∏õ‡∏≤‡∏Å‡∏Ñ‡∏°</option>
                                <option value="‡∏£‡∏û.‡∏™‡∏ï.‡∏õ‡∏≤‡∏Å‡πÅ‡∏à‡πà‡∏°">‡∏£‡∏û.‡∏™‡∏ï.‡∏õ‡∏≤‡∏Å‡πÅ‡∏à‡πà‡∏°</option>
                                <option value="‡∏£‡∏û.‡∏™‡∏ï.‡∏•‡∏≥‡∏†‡∏π‡∏£‡∏≤">‡∏£‡∏û.‡∏™‡∏ï.‡∏•‡∏≥‡∏†‡∏π‡∏£‡∏≤</option>
                                <option value="‡∏£‡∏û.‡∏™‡∏ï.‡∏ß‡∏±‡∏á‡∏Ñ‡∏µ‡∏£‡∏µ">‡∏£‡∏û.‡∏™‡∏ï.‡∏ß‡∏±‡∏á‡∏Ñ‡∏µ‡∏£‡∏µ</option>
                                <option value="‡∏£‡∏û.‡∏™‡∏ï.‡∏´‡∏ô‡∏≠‡∏á‡∏ä‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πà‡∏ô">‡∏£‡∏û.‡∏™‡∏ï.‡∏´‡∏ô‡∏≠‡∏á‡∏ä‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πà‡∏ô</option>
                                <option value="‡∏£‡∏û.‡∏™‡∏ï.‡∏´‡πâ‡∏ß‡∏¢‡∏ô‡∏≤‡∏á">‡∏£‡∏û.‡∏™‡∏ï.‡∏´‡πâ‡∏ß‡∏¢‡∏ô‡∏≤‡∏á</option>
                            </select>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-6">
    <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏â‡∏µ‡∏î</label>
        <input type="date" id="vaccineDate" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
    </div>
    <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤</label>
        <input type="text" id="vaccineName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤">
    </div>
    <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤</label>
        <input type="text" id="vaccineDosage" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ï‡πá‡∏°‡πÇ‡∏î‡∏™">
    </div>
    <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏â‡∏µ‡∏î</label>
        <input type="text" id="injectionSite" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏Ç‡∏ô‡∏ã‡πâ‡∏≤‡∏¢">
    </div>
    <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</label>
        <input type="text" id="vaccineRecorder" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å">
    </div>
</div>

                        <div class="flex justify-center">
                            <button type="button" onclick="addVaccineDate()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition duration-200">
                                ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î
                            </button>
                        </div>
                        <div id="vaccineDates" class="space-y-3"></div>
                        <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition duration-200">
                            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </button>
                    </form>
                </div>
            </div>

            <div id="dashboardContent" class="tab-content hidden">
                <div class="max-w-3xl mx-auto">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">üìä ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h2>
                        <div class="space-y-4" id="todayAppointments"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <div id="print-container" class="hidden"></div>

    <script>
        // =================================================================
        // SCRIPT CONFIGURATION
        // =================================================================
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz2m91xD4NHTEcqr-2G_CQ8FpmZ-_DcD6ZrWPONE_GbquonoK4za6_kbAsxSlaeClQZ/exec';
        let currentUserRole = '';
        let vaccineDatesArray = [];
        let appointmentDatesArray = [];
        let selectedDates = [];
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        // =================================================================
        // INITIALIZATION
        // =================================================================
        // ... (‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡πÜ) ...
document.addEventListener('DOMContentLoaded', function() {
    const loggedInUserRole = sessionStorage.getItem('userRole');
    const loggedInUserName = sessionStorage.getItem('userName'); // üü¢ ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏≤‡∏à‡∏≤‡∏Å sessionStorage
    
    if (loggedInUserRole) {
        // üü¢ ‡∏™‡πà‡∏á role ‡πÅ‡∏•‡∏∞ name ‡πÑ‡∏õ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
        showMainSystem(loggedInUserRole, loggedInUserName); 
    } else {
        document.body.className = 'login-body';
        document.getElementById('loginPage').classList.remove('hidden');
        document.getElementById('background-animation').classList.remove('hidden');
    }
});
// ... (‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡πÜ) ...

        function updateCurrentDate() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('th-TH', options);
        }

        // =================================================================
        // AUTHENTICATION & UI MANAGEMENT
        // =================================================================
       // ... (‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡πÜ) ...

document.getElementById('loginForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const loginButton = this.querySelector('button[type="submit"]');
    const originalButtonText = loginButton.textContent;

    loginButton.disabled = true;
    loginButton.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...';

    try {
        const response = await fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'text/plain' },
            body: JSON.stringify({ action: 'login', username, password })
        });
        const result = await response.json();
        if (result.success) {
            sessionStorage.setItem('userRole', result.role);
            sessionStorage.setItem('userName', result.name); // üü¢ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏á‡πÉ‡∏ô sessionStorage
            
            // üü¢ ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤ role ‡πÅ‡∏•‡∏∞ name ‡πÑ‡∏õ‡πÉ‡∏´‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô showMainSystem
            showMainSystem(result.role, result.name); 

        } else {
            alert('‚ùå ' + (result.message || result.error || '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'));
        }
    } catch (error) {
        console.error('Login Error:', error);
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå');
    } finally {
        loginButton.disabled = false;
        loginButton.textContent = originalButtonText;
    }
});

// ... (‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô ‡πÜ) ...

       // ***** MODIFIED FUNCTION START *****
// ‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏ó‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

function showMainSystem(role, name) { // üü¢ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå name
    document.body.className = 'bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen';
    
    document.getElementById('loginPage').classList.add('hidden');
    document.getElementById('background-animation').classList.add('hidden');
    
    document.getElementById('mainSystem').classList.remove('hidden');
    
    currentUserRole = role;
    
    // üü¢ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• ‡πÇ‡∏î‡∏¢‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏°‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    let userDisplay = role; // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ñ‡∏∑‡∏≠‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏Ñ‡πà role
    if (name) {
        userDisplay = `${role}: ${name}`; // ‡∏ñ‡πâ‡πà‡∏≤‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠ ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô "Role: Name"
    }
    document.getElementById('userRole').textContent = userDisplay; // ‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡πÅ‡∏™‡∏î‡∏á

    document.querySelectorAll('.admin-only').forEach(el => el.classList.remove('show'));
    if (role === '‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô') {
        document.querySelectorAll('.admin-only').forEach(el => el.classList.add('show'));
    }
    updateCurrentDate();
    generateCalendar();
    showTab('search');
}

// ***** MODIFIED FUNCTION END *****

        function logout() {
            sessionStorage.removeItem('userRole');
            
            // Change body class back to the login view
            document.body.className = 'login-body';

            // Hide main system
            document.getElementById('mainSystem').classList.add('hidden');
            
            // Show login elements
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('background-animation').classList.remove('hidden');
            
            document.getElementById('loginForm').reset();
            currentUserRole = '';
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
            document.querySelectorAll('.tab-button').forEach(tab => {
                tab.classList.remove('bg-white', 'text-blue-600', 'shadow-sm');
                tab.classList.add('text-gray-600');
            });
            document.getElementById(tabName + 'Content').classList.remove('hidden');
            const activeTab = document.getElementById(tabName + 'Tab');
            activeTab.classList.remove('text-gray-600');
            activeTab.classList.add('bg-white', 'text-blue-600', 'shadow-sm');
            if (tabName === 'dashboard') {
                loadDashboardData();
            }
        }

        // =================================================================
        // DASHBOARD FUNCTIONS
        // =================================================================
        async function loadDashboardData() {
            const container = document.getElementById('todayAppointments');
            container.innerHTML = '<p class="text-center text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢...</p>';
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    redirect: 'follow',
                    body: JSON.stringify({ action: 'getTodaysAppointments' })
                });
                const result = await response.json();
                if (result.success && result.data) {
                    container.innerHTML = '';
                    if (result.data.length > 0) {
                        result.data.forEach(app => {
                            const statusColor = app.status === '‡∏â‡∏µ‡∏î‡πÅ‡∏•‡πâ‡∏ß' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800';
                            const appointmentCard = document.createElement('div');
                            appointmentCard.className = 'flex justify-between items-center p-4 bg-blue-50 rounded-lg border border-blue-200';
                            appointmentCard.innerHTML = `
                                <div>
                                    <p class="font-medium text-blue-800">${app.name}</p>
                                    <p class="text-sm text-blue-600">${app.phone || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£'}</p>
                                    <p class="text-sm text-gray-600">${app.vaccine}</p>
                                </div>
                                <div class="text-right">
                                    <span class="inline-block px-2 py-1 text-xs rounded-full ${statusColor}">${app.status}</span>
                                </div>`;
                            container.appendChild(appointmentCard);
                        });
                    } else {
                        container.innerHTML = '<p class="text-center text-gray-500">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</p>';
                    }
                } else {
                    throw new Error(result.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
                }
            } catch (error) {
                console.error('Dashboard Load Error:', error);
                container.innerHTML = `<p class="text-center text-red-500">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}</p>`;
            }
        }

        // =================================================================
        // PATIENT SEARCH FUNCTIONS
        // =================================================================
        async function searchPatient() {
            const searchId = document.getElementById('searchId').value.trim();
            if (!searchId) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô');
                return;
            }
            const searchButton = document.querySelector('#searchContent button');
            const originalText = searchButton.textContent;
            searchButton.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...';
            searchButton.disabled = true;
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({ action: 'searchPatient', nationalId: searchId })
                });
                const result = await response.json();
                if (result.success) {
                    displayPatientInfo(result.data);
                } else {
                    alert('‚ùå ' + (result.error || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢'));
                    document.getElementById('patientInfo').classList.add('hidden');
                }
            } catch (error) {
                console.error('Search Error:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤');
            } finally {
                searchButton.textContent = originalText;
                searchButton.disabled = false;
            }
        }

// ***** MODIFIED FUNCTION START *****
// ‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏ó‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

function displayPatientInfo(patientData) {
    document.getElementById('patientName').textContent = patientData.name;
    document.getElementById('patientPhone').textContent = patientData.phone || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
    
    const appointmentContainer = document.getElementById('appointmentTableContainer');
    appointmentContainer.innerHTML = '';
    const vaccinationDates = new Set((patientData.history || []).map(record => record.date));

    if (patientData.appointments && patientData.appointments.length > 0) {
        let tableHtml = `
            <div class="overflow-x-auto rounded-lg border">
                <table class="min-w-full bg-white">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î (‡∏û.‡∏®.)</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏â‡∏µ‡∏î</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</th> <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ú‡∏π‡πâ‡∏â‡∏µ‡∏î</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">`;
        
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        patientData.appointments.forEach(app => {
            const appDate = new Date(app.date);
            let statusText = '';
            let statusColorClass = '';
            let recorderName = ''; 

            if (vaccinationDates.has(app.date)) {
                statusText = '‡∏â‡∏µ‡∏î‡πÅ‡∏•‡πâ‡∏ß';
                statusColorClass = 'bg-green-100 text-green-800';
                const historyRecord = patientData.history.find(h => h.date === app.date);
                if (historyRecord && historyRecord.createdBy) {
                    recorderName = historyRecord.createdBy;
                } else {
                    recorderName = app.createdBy || '-';
                }
            } else if (appDate < today) {
                statusText = '‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏ï‡∏≤‡∏°‡∏ô‡∏±‡∏î';
                statusColorClass = 'bg-red-100 text-red-800';
            } else {
                statusText = '‡∏£‡∏≠‡∏â‡∏µ‡∏î';
                statusColorClass = 'bg-gray-100 text-gray-800';
            }
            
            tableHtml += `
                <tr>
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-700">${formatThaiDate(app.date)}</td>
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-700">${app.vaccine}</td>
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-700">${app.dosage || '-'}</td>
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-700">${app.injectionSite || '-'}</td>
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-700">${app.createdBy || '-'}</td> <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-700">${recorderName}</td>
                    <td class="px-4 py-2 whitespace-nowrap text-sm">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColorClass}">${statusText}</span>
                    </td>
                </tr>`;
        });
        tableHtml += `</tbody></table></div>`;
        appointmentContainer.innerHTML = tableHtml;
    } else {
        appointmentContainer.innerHTML = '<p class="text-gray-500 text-center py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</p>';
    }

    const historyContainer = document.getElementById('vaccineHistory');
    historyContainer.innerHTML = '';
    if (patientData.history && patientData.history.length > 0) {
        patientData.history.forEach(record => {
            const historyItem = document.createElement('div');
            historyItem.className = 'flex justify-between items-center p-3 bg-white rounded-lg border';
            historyItem.innerHTML = `
                <div>
                    <p class="font-semibold text-gray-800">${record.vaccineName || 'N/A'}</p>
                    <p class="text-sm text-gray-600">${record.hospital || 'N/A'}</p>
                </div>
                <span class="text-sm text-gray-500">${formatThaiDate(record.date)}</span>`;
            historyContainer.appendChild(historyItem);
        });
    } else {
        historyContainer.innerHTML = '<p class="text-gray-500 text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô</p>';
    }
    document.getElementById('patientInfo').classList.remove('hidden');
}

// ***** MODIFIED FUNCTION END *****
        // =================================================================
        // DATA REGISTRATION & APPOINTMENT FUNCTIONS
        // =================================================================
        async function lookupPatientForAppointment() {
            const nationalId = document.getElementById('appointmentNationalId').value.trim();
            if (!nationalId) {
                return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤');
            }

            const lookupButton = document.querySelector('#appointmentContent button[onclick="lookupPatientForAppointment()"]');
            const originalButtonText = lookupButton.textContent;
            lookupButton.textContent = '...';
            lookupButton.disabled = true;

            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({ action: 'searchPatient', nationalId: nationalId })
                });
                const result = await response.json();

                if (result.success && result.data) {
                    const patient = result.data;
                    const nameParts = patient.name.split(' ');
                    document.getElementById('appointmentFirstName').value = nameParts[0] || '';
                    document.getElementById('appointmentLastName').value = nameParts.slice(1).join(' ') || '';
                    document.getElementById('appointmentPhone').value = patient.phone || '';

                    appointmentDatesArray = patient.appointments || [];
                    updateAppointmentDatesDisplay();
                    alert('‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÅ‡∏•‡∏∞‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                } else {
                    document.getElementById('appointmentFirstName').value = '';
                    document.getElementById('appointmentLastName').value = '';
                    document.getElementById('appointmentPhone').value = '';
                    appointmentDatesArray = [];
                    updateAppointmentDatesDisplay();
                    alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢ ‡∏ó‡πà‡∏≤‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢');
                }
            } catch (error) {
                console.error('Lookup Error:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
            } finally {
                lookupButton.textContent = originalButtonText;
                lookupButton.disabled = false;
            }
        }

        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = {
                firstName: document.getElementById('firstName').value.trim(),
                lastName: document.getElementById('lastName').value.trim(),
                nationalId: document.getElementById('nationalId').value.trim(),
                hospital: document.getElementById('hospital').value,
                vaccineDates: vaccineDatesArray
            };
            if (!formData.firstName || !formData.lastName || !formData.nationalId || !formData.hospital) {
                return alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
            }
            if (vaccineDatesArray.length === 0) {
                return alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
            }
            savePatientToGoogleSheets(formData);
        });

        async function savePatientToGoogleSheets(formData) {
    const submitButton = document.querySelector('#registerForm button[type="submit"]');
    const originalText = submitButton.textContent;
    submitButton.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
    submitButton.disabled = true;
    try {
        const vaccineRecords = formData.vaccineDates.map(vaccine => ({
            timestamp: new Date().toLocaleString('th-TH'),
            nationalId: formData.nationalId,
            firstName: formData.firstName,
            lastName: formData.lastName,
            phone: '', // Send empty string for phone
            hospital: formData.hospital,
            vaccineDate: formatThaiDate(vaccine.date),
            vaccineName: vaccine.vaccine,
            dosage: vaccine.dosage, 
            injectionSite: vaccine.site,
            status: '‡∏â‡∏µ‡∏î‡πÅ‡∏•‡πâ‡∏ß',
            // üü¢ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å currentUserRole ‡πÄ‡∏õ‡πá‡∏ô vaccine.recorder
            createdBy: vaccine.recorder 
        }));
        for (const record of vaccineRecords) {
            const response = await fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify({ action: 'savePatient', data: record })
            });
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        }
        alert(`‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!`);
        document.getElementById('registerForm').reset();
        vaccineDatesArray = [];
        updateVaccineDatesDisplay();
    } catch (error) {
        console.error('Error saving patient:', error);
        alert('‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
    } finally {
        submitButton.textContent = originalText;
        submitButton.disabled = false;
    }
}
         
        document.getElementById('appointmentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = {
                nationalId: document.getElementById('appointmentNationalId').value,
                phone: document.getElementById('appointmentPhone').value,
                firstName: document.getElementById('appointmentFirstName').value,
                lastName: document.getElementById('appointmentLastName').value,
                appointments: appointmentDatesArray
            };
             if (!formData.firstName || !formData.lastName || !formData.phone || !formData.nationalId) {
                return alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
            }
            if (appointmentDatesArray.length === 0) {
                return alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
            }
            saveAppointmentToGoogleSheets(formData);
        });

        // ***** MODIFIED FUNCTION START *****
// ‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏ó‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

async function saveAppointmentToGoogleSheets(formData) {
    const submitButton = document.querySelector('#appointmentForm button[type="submit"]');
    const originalText = submitButton.textContent;
    submitButton.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
    submitButton.disabled = true;

    try {
        // üü¢ ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏≤‡∏Å sessionStorage
        // ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ Role ‡πÅ‡∏ó‡∏ô (‡πÄ‡∏ä‡πà‡∏ô '‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô')
        const loggedInUserName = sessionStorage.getItem('userName') || sessionStorage.getItem('userRole');

        const appointments = formData.appointments.map(appointment => ({
            timestamp: new Date().toLocaleString('th-TH'),
            nationalId: formData.nationalId,
            firstName: formData.firstName,
            lastName: formData.lastName,
            phone: formData.phone,
            appointmentDate: formatThaiDate(appointment.date),
            vaccine: appointment.vaccine,
            dosage: appointment.dosage, 
            injectionSite: appointment.injectionSite, 
            status: '‡∏£‡∏≠‡∏â‡∏µ‡∏î', // üü¢ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô '‡∏£‡∏≠‡∏â‡∏µ‡∏î'
            createdBy: loggedInUserName // üü¢ ‡∏™‡πà‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢
        }));

        for (const appointment of appointments) {
            await fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify({ action: 'saveAppointment', data: appointment })
            });
        }
        
        alert(`‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!`);
        printCurrentAppointmentCard(); 

        document.getElementById('appointmentForm').reset();
        appointmentDatesArray = [];
        updateAppointmentDatesDisplay();

    } catch (error) {
        console.error('Error saving appointment:', error);
        alert('‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
    } finally {
        submitButton.textContent = originalText;
        submitButton.disabled = false;
    }
}

// ***** MODIFIED FUNCTION END *****

        // =================================================================
        // HELPER & UTILITY FUNCTIONS
        // =================================================================
        function printCurrentAppointmentCard() {
            const formData = {
                nationalId: document.getElementById('appointmentNationalId').value,
                phone: document.getElementById('appointmentPhone').value,
                firstName: document.getElementById('appointmentFirstName').value,
                lastName: document.getElementById('appointmentLastName').value,
                appointments: appointmentDatesArray
            };

            if (!formData.firstName || !formData.lastName || !formData.nationalId || formData.appointments.length === 0) {
                return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå');
            }
            printAppointmentCard(formData);
        }

        function printAppointmentCard(formData) {
            const printContainer = document.getElementById('print-container');
            
            let appointmentRows = '';
            formData.appointments.forEach(app => {
                appointmentRows += `
                    <tr class="border-b">
                        <td class="py-2 px-4 text-left">${formatThaiDate(app.date)}</td>
                        <td class="py-2 px-4 text-left">${app.vaccine}</td>
                        <td class="py-2 px-4 text-left">${app.dosage || '-'}</td>
                        <td class="py-2 px-4 text-left">${app.injectionSite || '-'}</td>
                        <td class="py-2 px-4 text-left" style="border-bottom: 1px dotted #999;"></td>
                    </tr>
                `;
            });

            const cardHTML = `
                <div id="print-card" class="p-0 bg-white flex flex-col h-full text-gray-800 text-base">
                    <div class="text-center mb-8">
                        <h1 class="text-2xl font-bold">‡πÉ‡∏ö‡∏ô‡∏±‡∏î‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î‡∏¢‡∏≤</h1>
                        <p class="text-lg">‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏à‡∏¥‡∏ï‡πÄ‡∏ß‡∏ä‡πÅ‡∏•‡∏∞‡∏¢‡∏≤‡πÄ‡∏™‡∏û‡∏ï‡∏¥‡∏î ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏´‡πâ‡∏ß‡∏¢‡∏¢‡∏≠‡∏î</p>
                    </div>
                    <div class="mb-8">
                        <h2 class="text-lg font-semibold border-b pb-2 mb-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</h2>
                        <div class="space-y-2 text-sm">
                            <div class="flex">
                                <span class="font-medium text-gray-600 w-1/3">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</span>
                                <span class="font-bold">${formData.firstName} ${formData.lastName}</span>
                            </div>
                            <div class="flex">
                                <span class="font-medium text-gray-600 w-1/3">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô:</span>
                                <span class="font-bold">${formData.nationalId}</span>
                            </div>
                            <div class="flex">
                                <span class="font-medium text-gray-600 w-1/3">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå:</span>
                                <span class="font-bold">${formData.phone || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h2 class="text-lg font-semibold border-b pb-2 mb-4">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</h2>
                        <table class="w-full text-left border-collapse text-sm">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="py-2 px-4 font-semibold text-left">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î</th>
                                    <th class="py-2 px-4 font-semibold text-left">‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô</th>
                                    <th class="py-2 px-4 font-semibold text-left">‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤</th>
                                    <th class="py-2 px-4 font-semibold text-left">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏â‡∏µ‡∏î</th>
                                    <th class="py-2 px-4 font-semibold text-left">‡∏•‡∏≤‡∏¢‡∏°‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${appointmentRows}
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Signature Block -->
                    <div class="mt-auto pt-16 flex justify-end text-sm">
                        <div class="text-center">
                            <p class="mb-4">....................................................</p>
                            <p>(....................................................)</p>
                            <p>‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å/‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</p>
                        </div>
                    </div>

                    <div class="pt-4 text-center text-xs text-gray-500">
                        <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏°‡∏≤‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡πÉ‡∏ö‡∏ô‡∏±‡∏î‡∏ô‡∏µ‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                        <p>‡∏û‡∏¥‡∏°‡∏û‡πå ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date().toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                    </div>
                </div>
            `;

            printContainer.innerHTML = cardHTML;
            
            setTimeout(() => {
                window.print();
            }, 100);
        }

        function addVaccineDate() {
    const date = document.getElementById('vaccineDate').value;
    const vaccine = document.getElementById('vaccineName').value;
    const dosage = document.getElementById('vaccineDosage').value;
    const site = document.getElementById('injectionSite').value;
    const recorder = document.getElementById('vaccineRecorder').value; // üü¢ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ

    if (date && vaccine && dosage && site && recorder) { // üü¢ ‡πÄ‡∏û‡∏¥‡πà‡∏° recorder ‡πÉ‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç
        vaccineDatesArray.push({ date, vaccine, dosage, site, recorder }); // üü¢ ‡πÄ‡∏û‡∏¥‡πà‡∏° recorder ‡πÉ‡∏ô object
        updateVaccineDatesDisplay();
        document.getElementById('vaccineDate').value = '';
        document.getElementById('vaccineName').value = '';
        document.getElementById('vaccineDosage').value = '';
        document.getElementById('injectionSite').value = '';
        document.getElementById('vaccineRecorder').value = ''; // üü¢ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ
    } else {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô'); // üü¢ ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
    }
}

        function updateVaccineDatesDisplay() {
    const container = document.getElementById('vaccineDates');
    container.innerHTML = '';
    vaccineDatesArray.forEach((data, index) => {
        const div = document.createElement('div');
        div.className = 'flex items-center space-x-4 p-4 bg-blue-50 rounded-lg border border-blue-200';
        div.innerHTML = `
            <div class="flex-1">
                <p class="font-medium text-blue-800">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏â‡∏µ‡∏î: ${formatThaiDate(data.date)}</p>
                <p class="text-sm text-blue-600">‡∏¢‡∏≤: ${data.vaccine} (${data.dosage}, ${data.site}) | ‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: ${data.recorder}</p>
            </div>
            <button onclick="removeVaccineDate(${index})" class="bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600">‡∏•‡∏ö</button>`;
        container.appendChild(div);
    });
}

        function removeVaccineDate(index) {
            vaccineDatesArray.splice(index, 1);
            updateVaccineDatesDisplay();
        }

        function addSelectedDates() {
            const vaccine = document.getElementById('appointmentVaccine').value;
            const dosage = document.getElementById('appointmentDosage').value;
            const injectionSite = document.getElementById('appointmentInjectionSite').value;

            if (selectedDates.length === 0) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢');
            if (!vaccine || !dosage || !injectionSite) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô (‡∏¢‡∏≤, ‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤, ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á)');
            
            selectedDates.forEach(date => appointmentDatesArray.push({ date, vaccine, dosage, injectionSite }));
            updateAppointmentDatesDisplay();
            selectedDates = [];
            document.getElementById('appointmentVaccine').value = '';
            document.getElementById('appointmentDosage').value = '';
            document.getElementById('appointmentInjectionSite').value = '';
            generateCalendar();
        }

        function updateAppointmentDatesDisplay() {
            const container = document.getElementById('appointmentDates');
            container.innerHTML = '';
            appointmentDatesArray.forEach((data, index) => {
                const div = document.createElement('div');
                div.className = 'flex items-center space-x-4 p-4 bg-green-50 rounded-lg border border-green-200';
                div.innerHTML = `
                    <div class="flex-1">
                        <p class="font-medium text-green-800">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î: ${formatThaiDate(data.date)}</p>
                        <p class="text-sm text-green-600">‡∏¢‡∏≤: ${data.vaccine} (${data.dosage}, ${data.injectionSite})</p>
                    </div>
                    <button onclick="deleteAppointmentFromSheet(${index})" class="bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600">‡∏•‡∏ö</button>`;
                container.appendChild(div);
            });
        }

        async function deleteAppointmentFromSheet(index) {
            const appointmentToDelete = appointmentDatesArray[index];
            const nationalId = document.getElementById('appointmentNationalId').value;

            if (!confirm(`‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${formatThaiDate(appointmentToDelete.date)} ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                return;
            }

            const deleteButton = event.target;
            deleteButton.textContent = '...';
            deleteButton.disabled = true;

            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'deleteAppointment',
                        nationalId: nationalId,
                        appointmentDate: appointmentToDelete.date 
                    })
                });
                const result = await response.json();
                if (result.success) {
                    alert('‡∏•‡∏ö‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                    appointmentDatesArray.splice(index, 1);
                    updateAppointmentDatesDisplay();
                } else {
                    throw new Error(result.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
                }
            } catch (error) {
                console.error('Delete Error:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message);
                deleteButton.textContent = '‡∏•‡∏ö';
                deleteButton.disabled = false;
            }
        }

        function generateCalendar() {
            const calendar = document.getElementById('multiDateCalendar');
            const monthNames = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô', '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];
            const dayNames = ['‡∏≠‡∏≤', '‡∏à', '‡∏≠', '‡∏û', '‡∏û‡∏§', '‡∏®', '‡∏™'];
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            let calendarHTML = `
                <div class="p-4">
                    <div class="flex justify-between items-center mb-4">
                        <button type="button" onclick="previousMonth()" class="p-2 hover:bg-gray-100 rounded-lg">&lt;</button>
                        <h3 class="text-lg font-semibold">${monthNames[currentMonth]} ${currentYear + 543}</h3>
                        <button type="button" onclick="nextMonth()" class="p-2 hover:bg-gray-100 rounded-lg">&gt;</button>
                    </div>
                    <div class="grid grid-cols-7 gap-1 mb-2">
                        ${dayNames.map(day => `<div class="text-center text-sm font-medium text-gray-600 p-2">${day}</div>`).join('')}
                    </div>
                    <div class="grid grid-cols-7 gap-1">`;
            for (let i = 0; i < firstDay.getDay(); i++) { calendarHTML += `<div class="p-2"></div>`; }
            const today = new Date();
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const isToday = today.getFullYear() === currentYear && today.getMonth() === currentMonth && today.getDate() === day;
                const isSelected = selectedDates.includes(dateStr);
                const isPast = new Date(currentYear, currentMonth, day) < new Date(today.getFullYear(), today.getMonth(), today.getDate());
                let classes = 'p-2 text-center cursor-pointer rounded-lg transition-colors duration-200 ';
                if (isPast) classes += 'text-gray-400 cursor-not-allowed ';
                else if (isSelected) classes += 'bg-blue-600 text-white hover:bg-blue-700 ';
                else if (isToday) classes += 'bg-blue-100 text-blue-600 hover:bg-blue-200 ';
                else classes += 'hover:bg-gray-100 ';
                const onclick = isPast ? '' : `onclick="toggleDate('${dateStr}')"`;
                calendarHTML += `<div class="${classes}" ${onclick}>${day}</div>`;
            }
            calendarHTML += `</div></div>`;
            calendar.innerHTML = calendarHTML;
            updateSelectedDatesCount();
        }

        function previousMonth() {
            currentMonth--;
            if (currentMonth < 0) { currentMonth = 11; currentYear--; }
            generateCalendar();
        }

        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) { currentMonth = 0; currentYear++; }
            generateCalendar();
        }

        function toggleDate(dateStr) {
            const index = selectedDates.indexOf(dateStr);
            if (index > -1) selectedDates.splice(index, 1);
            else selectedDates.push(dateStr);
            generateCalendar();
        }

        function updateSelectedDatesCount() {
            document.getElementById('selectedDatesCount').textContent = selectedDates.length;
        }

        function formatThaiDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            if (isNaN(date.getTime())) return '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
            const year = date.getFullYear();
            const thaiYear = year > 2500 ? year : year + 543;
            const thaiMonths = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô', '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];
            return `${date.getDate()} ${thaiMonths[date.getMonth()]} ${thaiYear}`;
        }
         
        ['appointmentPhone'].forEach(id => {
            document.getElementById(id).addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 10) value = value.substring(0, 10);
                if (value.length >= 3 && value.length <= 6) value = value.replace(/(\d{3})(\d+)/, '$1-$2');
                else if (value.length > 6) value = value.replace(/(\d{3})(\d{3})(\d+)/, '$1-$2-$3');
                e.target.value = value;
            });
        });
        ['nationalId', 'appointmentNationalId', 'searchId'].forEach(id => {
            document.getElementById(id).addEventListener('input', function(e) {
                e.target.value = e.target.value.replace(/\D/g, '');
            });
        });
    </script>
</body>
</html>






